# 范文参考功能说明

## 功能概述

AI宣传稿生成系统现已支持**范文参考功能**。系统会自动从 `examples` 文件夹中加载对应类型的范文，并在生成宣传稿时将其作为参考依据，确保生成的文章结构与范文保持一致。

## 工作原理

### 1. 范文存储

所有范文存储在 `d:\AI project\xuanchuangao\examples` 目录下，按类型分类：

```
examples/
├── 重要会议/
│   └── 中人建设党委召开第四季度理论学习中心组学习（扩大）会.png
├── 培训活动/
│   └── 以案促管、以管创效——中人建设开展2023年廉洁大讲堂暨合规风控培训会议.png
├── 领导带队检查/
│   └── 20240821庄志民带队到晟宁实业开展现场督导检查工作-罗志华 - 终稿.docx
├── 项目中标/
│   └── 中人建设2024年度首个家具产业园施工总承包项目落地花都.png
├── 项目重大进展/
│   └── 20230321中人建设江山帝景普罗旺斯项目顺利通过验收交付（中人建设）-罗志华-萧改.docx
└── 科技创新/
    └── E1中人建设成功通过国家高新技术企业认定.docx
```

### 2. 范文加载

当用户选择某个模板类型时，系统会：

1. 自动查找 `examples/{模板类型}` 文件夹
2. 优先加载 `.docx` 文件，其次加载其他格式文件
3. 解析文件内容，提取文本信息
4. 将范文内容添加到系统提示词中

### 3. 支持的文件格式

- **Word 文档** (.docx) - 推荐
- **PowerPoint 演示文稿** (.pptx)
- **PDF 文档** (.pdf)
- **图片文件** (.png, .jpg, .jpeg) - 作为参考标记
- **文本文件** (.txt)

### 4. 生成流程

```
用户选择模板 → 加载对应范文 → 构建提示词 → 调用大模型API → 生成宣传稿
                ↓
        提取范文结构和风格
                ↓
        添加到系统提示词中
```

## 技术实现

### 核心文件

1. **`backend/service/example_loader.py`**
   - 范文加载器
   - 负责从文件系统加载和解析范文
   - 支持多种文件格式

2. **`backend/service/prompts.py`**
   - 添加了 `EXAMPLE_REFERENCE_PROMPT` 常量
   - 定义范文参考的提示词模板

3. **`backend/service/llm.py`**
   - 在 `generate_draft_stream` 方法中集成范文加载
   - 将范文内容添加到系统消息中

### 关键代码

```python
# 加载范文内容
example_content = load_example(template_type)

# 如果有范文，添加范文参考提示
if example_content:
    system_content += EXAMPLE_REFERENCE_PROMPT.format(example_content=example_content)
```

## 使用方法

### 自动使用（推荐）

用户无需任何额外操作，系统会自动：

1. 在用户选择模板时加载对应范文
2. 将范文作为参考传递给大模型
3. 生成符合范文风格的宣传稿

### 手动添加范文

如果需要添加新的范文：

1. 在 `examples` 目录下创建对应的类型文件夹
2. 将范文文件放入该文件夹
3. 确保文件夹名称与模板类型完全一致
4. 重启后端服务

**示例：**

```bash
# 创建新的范文文件夹
mkdir "examples\新场景类型"

# 复制范文文件
copy "我的范文.docx" "examples\新场景类型\"
```

## 测试验证

### 测试脚本

系统提供了两个测试脚本：

#### 1. 范文加载测试

```bash
cd backend
python test_example_loader.py
```

测试内容：
- 单个范文加载
- 所有范文加载
- 范文内容质量检查

#### 2. 范文参考功能测试

```bash
cd backend
python test_example_reference.py
```

测试内容：
- 健康检查接口
- 模板列表接口
- 6种类型宣传稿生成测试

### 测试结果

运行测试后，系统会输出详细的测试结果，包括：

- ✓ 范文加载状态
- ✓ 生成内容预览
- ✓ 测试通过/失败统计

## 优势特点

1. **自动化**：无需用户手动操作，系统自动加载范文
2. **灵活性**：支持多种文件格式，易于扩展
3. **一致性**：确保生成的宣传稿与范文风格一致
4. **可维护**：范文文件独立存储，便于管理和更新
5. **可测试**：提供完整的测试脚本，便于验证功能

## 注意事项

1. **文件夹名称**：必须与模板类型完全一致（区分大小写）
2. **文件格式**：推荐使用 `.docx` 格式，解析效果最好
3. **内容质量**：范文质量直接影响生成效果
4. **服务重启**：添加新范文后需要重启后端服务
5. **API限制**：范文内容会增加 token 消耗，注意 API 使用量

## 故障排除

### 范文未加载

**问题**：生成的宣传稿没有参考范文风格

**检查步骤**：
1. 确认 `examples` 文件夹存在
2. 确认对应的类型文件夹存在
3. 确认文件夹中有范文文件
4. 查看后端日志，确认范文加载状态

### 解析失败

**问题**：范文文件解析失败

**解决方案**：
1. 确认文件格式支持
2. 尝试将文件转换为 `.docx` 格式
3. 检查文件是否损坏

### 生成效果不佳

**问题**：生成的宣传稿风格与范文不一致

**优化建议**：
1. 提高范文质量，确保结构清晰
2. 增加范文数量，提供更多参考
3. 调整 `EXAMPLE_REFERENCE_PROMPT` 提示词

## 未来改进

1. **多范文支持**：支持加载多个范文，综合参考
2. **范文评分**：自动评估范文质量
3. **智能匹配**：根据用户输入智能选择最合适的范文
4. **范文管理**：提供 Web 界面管理范文
5. **效果评估**：对比生成结果与范文的相似度

## 总结

范文参考功能通过自动加载和使用范文，显著提升了宣传稿生成的质量和一致性。用户无需额外操作即可享受这一功能，系统会智能地参考范文的结构、风格和逻辑，生成高质量的宣传稿。

---

**版本**：v1.0  
**更新日期**：2024年  
**维护者**：AI宣传稿生成系统开发团队
